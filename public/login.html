<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>비 오는 로그인 및 회원가입</title>
    <style>
      /* 기존 스타일 유지 */
    </style>
  </head>
  <body>
    <div class="rain"></div>
    <div id="login-container" class="container">
      <h1>로그인</h1>
      <input type="text" id="username" placeholder="사용자 이름" />
      <input type="password" id="password" placeholder="비밀번호" />
      <button id="login-button">로그인</button>
      <p id="login-message"></p>
      <p>계정이 없으신가요? <a href="#" id="show-register">회원가입</a></p>
    </div>

    <div id="register-container" class="container hidden">
      <h1>회원가입</h1>
      <input type="email" id="email" placeholder="이메일" />
      <input type="text" id="new-username" placeholder="사용자 이름" />
      <input type="password" id="new-password" placeholder="비밀번호" />
      <button id="register-button">회원가입</button>
      <p id="register-message"></p>
      <p>이미 계정이 있으신가요? <a href="#" id="show-login">로그인</a></p>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const rainContainer = document.querySelector(".rain");

        // 비 드롭 생성
        const createRainDrop = () => {
          const drop = document.createElement("div");
          drop.classList.add("drop");
          drop.style.left = Math.random() * 100 + "vw";
          drop.style.animationDuration = Math.random() * 0.5 + 0.5 + "s"; // 0.5초에서 1초 사이
          rainContainer.appendChild(drop);

          // 드롭이 떨어진 후 제거
          drop.addEventListener("animationend", () => {
            drop.remove();
          });
        };

        // 일정 간격으로 드롭 생성
        setInterval(createRainDrop, 100);

        // 로그인과 회원가입 전환
        document
          .getElementById("show-register")
          .addEventListener("click", (e) => {
            e.preventDefault();
            document.getElementById("login-container").classList.add("hidden");
            document
              .getElementById("register-container")
              .classList.remove("hidden");
          });

        document.getElementById("show-login").addEventListener("click", (e) => {
          e.preventDefault();
          document.getElementById("register-container").classList.add("hidden");
          document.getElementById("login-container").classList.remove("hidden");
        });

        // 로그인 버튼 클릭 시 처리
        document
          .getElementById("login-button")
          .addEventListener("click", () => {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            // 로그인 요청
            fetch(window.location.origin + "/api/login", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                loginId: username,
                password: password,
              }),
            })
              .then((response) => {
                // 응답 상태 확인
                if (!response.ok) {
                  throw new Error("로그인 요청 실패");
                }
                return response.json();
              })
              .then((data) => {
                if (data.success) {
                  document.getElementById("login-message").innerText =
                    "로그인 성공!";
                  // 로그인 성공 후 추가 처리 (예: 리다이렉트)
                } else {
                  document.getElementById("login-message").innerText =
                    "로그인 실패: " + data.message;
                }
              })
              .catch((error) => {
                console.error("로그인 요청 오류:", error);
                document.getElementById("login-message").innerText =
                  "오류 발생: " + error.message;
              });
          });

        // 회원가입 버튼 클릭 시 처리
        document
          .getElementById("register-button")
          .addEventListener("click", () => {
            const newUsername = document.getElementById("new-username").value;
            const newPassword = document.getElementById("new-password").value;
            const email = document.getElementById("email").value;

            fetch(window.location.origin + "/api/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                email: email,
                loginId: newUsername,
                password: newPassword,
              }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  document.getElementById("register-message").innerText =
                    "회원가입 성공!";
                } else {
                  document.getElementById("register-message").innerText =
                    "회원가입 실패: " + data.message;
                }
              })
              .catch((error) => {
                document.getElementById("register-message").innerText =
                  "오류 발생: " + error.message;
              });
          });
      });
    </script>
  </body>
</html>
